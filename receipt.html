<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Receipt - ONE STOP</title>

<style>
:root{
  --dark:#111;
  --accent:#2E8B57;
  --muted:#f4f6f8;
  --card:#ffffff;
  --danger:#c0392b;
}
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:var(--muted);
  color:#222;
}
header{
  background:var(--dark);
  padding:12px 16px;
  color:#fff;
  text-align:center;
  font-size:1.2rem;
  font-weight:bold;
}
.container{
  max-width:650px;
  background:var(--card);
  margin:30px auto;
  padding:22px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
}
h2{text-align:center; color:var(--accent);}
.info{
  margin-bottom:15px;
  background:#f7faf7;
  padding:12px;
  border-radius:8px;
  line-height:1.6;
}
table{
  width:100%;
  border-collapse:collapse;
}
th, td{
  padding:10px;
  border-bottom:1px solid #eee;
}
th{text-align:left;}
.item-img{
  width:60px;
  height:60px;
  border-radius:6px;
  object-fit:cover;
  margin-right:6px;
  border:2px solid #ddd;
}
.total-box{
  margin-top:15px;
  font-size:1.2rem;
  font-weight:bold;
  text-align:right;
  color:var(--accent);
}
.invoice{
  font-size:0.9rem;
  margin-bottom:10px;
  color:#444;
}
.status{
  text-align:right;
  color:green;
  font-weight:bold;
  font-size:0.95rem;
}
.btn-area{
  margin-top:20px;
  display:flex;
  justify-content:space-between;
}
button{
  padding:10px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}
.print-btn{ background:var(--accent); color:white; }
.home-btn{ background:var(--dark); color:white; }
@media(max-width:600px){
  .btn-area{ flex-direction:column; gap:10px; }
}
</style>
</head>

<body>
<header>ONE STOP OFFICIAL RECEIPT</header>

<div class="container">
  <h2>Purchase Receipt</h2>

  <div class="invoice">
    <strong>Transaction ID:</strong> <span id="trxId"></span><br>
    <strong>Status:</strong> <span class="status">âœ… Successful</span>
  </div>

  <div class="info">
    <strong>Date:</strong> <span id="receiptDate"></span><br>
    <strong>User Email:</strong> <span id="userEmail"></span><br>
    <strong>Payment Method:</strong> <span id="method"></span>
  </div>

  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th style="width:80px;">Price</th>
      </tr>
    </thead>
    <tbody id="receiptBody"></tbody>
  </table>

  <div class="total-box" id="receiptTotal"></div>

  <div class="btn-area">
    <button class="print-btn" onclick="window.print()">Print Receipt</button>
    <button class="home-btn" onclick="goHome()">Home</button>
  </div>
</div>

<script>
function loadReceipt(){
  const receipt = JSON.parse(localStorage.getItem("last_receipt") || "{}");
  const body = document.getElementById("receiptBody");
  const totalEl = document.getElementById("receiptTotal");
  const methodEl = document.getElementById("method");
  const dateEl = document.getElementById("receiptDate");
  const emailEl = document.getElementById("userEmail");
  const trx = document.getElementById("trxId");

  body.innerHTML = "";
  let total = 0;

  if(!receipt.items || receipt.items.length===0){
    body.innerHTML = `<tr><td colspan="2" style="text-align:center;">No items found</td></tr>`;
  } else {
    receipt.items.forEach(item=>{
      let qty = Number(item.qty || 1);
      let price = Number(item.price || 0);
      total += price * qty;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td><img src="${item.img}" class="item-img"> ${item.name}</td>
        <td>Ksh ${price * qty}</td>
      `;
      body.appendChild(row);
    });
  }

  totalEl.textContent = "Total Paid: Ksh " + total;
  methodEl.textContent = receipt.method || "N/A";
  emailEl.textContent = receipt.email || "Not Provided";
  dateEl.textContent = receipt.date || new Date().toLocaleString();
  trx.textContent = receipt.orderId || "TRX-" + Math.floor(Math.random()*999999);
}

function goHome(){
  window.location.href = "index.html";
}

loadReceipt();
</script>
</body>
</html>
