<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - ONE STOP</title>

<style>
    :root{
        --dark:#111;
        --accent:#2E8B57;
        --accent-dark:#256b4a;
        --muted:#f4f6f8;
        --card:#fff;
        --danger:#c0392b;
    }

    *{ box-sizing:border-box; }

    body{
        margin:0;
        font-family:Arial, Helvetica, sans-serif;
        background:var(--muted);
    }

    header{
        background:var(--dark);
        padding:14px;
        color:white;
    }

    nav a{
        margin-right:14px;
        color:#ddd;
        text-decoration:none;
        font-weight:600;
    }
    nav a:hover{ color:white; }

    .container{
        max-width:600px;
        margin:30px auto;
        background:var(--card);
        padding:25px;
        border-radius:8px;
        box-shadow:0 4px 12px rgba(0,0,0,0.08);
    }

    h2{
        color:var(--dark);
        text-align:center;
        margin-bottom:20px;
    }

    label{
        display:block;
        font-weight:700;
        margin-top:10px;
        margin-bottom:4px;
    }

    input, select{
        width:100%;
        padding:10px;
        border-radius:6px;
        border:1px solid #ccc;
        margin-bottom:10px;
        font-size:16px;
    }

    .total{
        background:#eef5ef;
        padding:14px;
        border-radius:6px;
        text-align:center;
        font-size:20px;
        font-weight:700;
        margin-bottom:18px;
        border:1px solid var(--accent);
    }

    .preview{
        font-size:14px;
        background:#f3f3f3;
        border-radius:6px;
        padding:10px;
        margin-bottom:15px;
    }

    button{
        width:100%;
        padding:12px;
        border:0;
        border-radius:8px;
        background:var(--accent);
        font-size:18px;
        color:white;
        font-weight:700;
        cursor:pointer;
    }
    button:hover{ background:var(--accent-dark); }
</style>

</head>
<body>

<header>
    <nav>
        <a href="index.html">Home</a>
        <a href="product.html">Products</a>
        <a href="cart.html">Cart</a>
        <a href="payment.html">Payment</a>
    </nav>
</header>

<div class="container">
    <h2>Complete Payment</h2>

    <div class="preview" id="summaryBox"></div>

    <div class="total">
        Total Payable: <span id="totalDisplay">Ksh 0</span>
    </div>

    <label>Choose Payment Method</label>
    <select id="method" onchange="toggleMethod()">
        <option value="mpesa">M-Pesa</option>
        <option value="card">Credit/Debit Card</option>
    </select>

    <!-- M-Pesa Form -->
    <div id="mpesaForm">
        <label>Phone Number</label>
        <input type="text" id="mpesaPhone" placeholder="e.g 0712345678">
    </div>

    <!-- Card Form -->
    <div id="cardForm" style="display:none;">
        <label>Card Number</label>
        <input type="text" id="cardNumber" placeholder="1234 5678 2345 9012">

        <label>Expiry Date</label>
        <input type="month" id="expiry">

        <label>CVV</label>
        <input type="password" id="cvv" placeholder="123">
    </div>

    <button onclick="processPayment()">Pay Now</button>
</div>

<script>

    // Load data
    let total = localStorage.getItem("checkout_total") || 0;
    let items = JSON.parse(localStorage.getItem("checkout_items") || "[]");
    let email = localStorage.getItem("checkout_email") || "N/A";
    let date = localStorage.getItem("checkout_date") || "N/A";
    let time = localStorage.getItem("checkout_time") || "N/A";

    // Display total
    document.getElementById("totalDisplay").textContent = "Ksh " + total;

    // Display preview
    let summary = document.getElementById("summaryBox");
    let list = items.map(i => `â€¢ ${i.name} (x${i.qty})`).join("<br>");

    summary.innerHTML = `
        <b>Email:</b> ${email}<br>
        <b>Date:</b> ${date}<br>
        <b>Time:</b> ${time}<br><br>
        <b>Items:</b><br>${list}
    `;

    // Toggle Payment Forms
    function toggleMethod(){
        let m = document.getElementById("method").value;
        document.getElementById("mpesaForm").style.display = m === "mpesa" ? "block" : "none";
        document.getElementById("cardForm").style.display = m === "card" ? "block" : "none";
    }

    function processPayment(){

        if(total <= 0){
            alert("Your total is 0. Please add items.");
            return;
        }

        let method = document.getElementById("method").value;

        if(method === "mpesa"){
            let phone = document.getElementById("mpesaPhone").value;
            if(phone.length < 10){
                alert("Enter valid M-Pesa number!");
                return;
            }
        }

        if(method === "card"){
            let card = document.getElementById("cardNumber").value;
            let cvv = document.getElementById("cvv").value;
            if(card.length < 16 || cvv.length < 3){
                alert("Enter valid card details!");
                return;
            }
        }

        // Build receipt data
        let receipt = {
            orderId: "ORD-" + Math.floor(Math.random()*99999),
            email: email,
            date: date,
            time: time,
            total: total,
            method: method.toUpperCase(),
            items: items
        };

        // Save for receipt page
        localStorage.setItem("last_receipt", JSON.stringify(receipt));

        // Clear cart
        localStorage.removeItem("one_stop_cart");

        window.location.href = "receipt.html";
    }

</script>

</body>
</html>
