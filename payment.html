<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - ONE STOP</title>
<style>
:root{
  --dark:#111;
  --accent:#2E8B57;
  --accent-dark:#256b4a;
  --muted:#f4f6f8;
  --card:#fff;
  --danger:#c0392b;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background: var(--muted);
  color: #222;
}
header.site-header{
  background: var(--dark);
  color:#fff;
  padding:12px 18px;
}
header.site-header a{
  color:#ddd;
  text-decoration:none;
  margin-right:12px;
}
header.site-header a:hover{ color:#fff; }

main{ max-width:1100px; margin:20px auto; padding:0 16px; }
h1{ margin-bottom:10px; color: var(--dark); }

.card{
  background: var(--card);
  padding:16px;
  border-radius:8px;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
  margin-bottom:16px;
}

.cart-table, .payment-table{ width:100%; border-collapse:collapse; margin-top:10px; }
.cart-table th, .cart-table td, .payment-table th, .payment-table td{ padding:12px 10px; text-align:left; border-bottom:1px solid #f0f0f0; }
.cart-table thead, .payment-table thead{ background:#fafafa; font-weight:700; }
.cart-item-img{ width:50px; height:50px; object-fit:cover; border-radius:6px; }

label{ display:block; font-weight:700; margin-top:10px; margin-bottom:4px; }
input, select{ width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px; font-size:16px; }
button{
  width:100%;
  padding:12px;
  border:0;
  border-radius:8px;
  background:var(--accent);
  font-size:16px;
  color:white;
  font-weight:700;
  cursor:pointer;
}
button:hover{ background:var(--accent-dark); }

.summary{ margin-top:10px; font-weight:700; font-size:1.05rem; }
@media (max-width:600px){
  .payment-table thead{ display:none; }
  .payment-table tr{ display:block; margin-bottom:12px; }
  .payment-table td{ display:flex; justify-content:space-between; }
}
</style>
</head>
<body>

<header class="site-header">
  <a href="cart.html">‚Üê Back to Cart</a>
  Payment
</header>

<main>
<h1>Complete Payment</h1>

<div class="card">
  <h3>Order Summary</h3>
  <table class="payment-table" id="summaryTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="summary" id="totalAmount"></div>
  <div class="summary" id="emailDiv"></div>
</div>

<div class="card">
  <h3>Choose Payment Method</h3>
  <select id="method" onchange="toggleMethod()">
    <option value="mpesa">M-Pesa</option>
    <option value="card">Credit/Debit Card</option>
  </select>

  <div id="mpesaForm">
    <label>Phone Number</label>
    <input type="text" id="mpesaPhone" placeholder="e.g 0712345678">
  </div>

  <div id="cardForm" style="display:none;">
    <label>Card Number</label>
    <input type="text" id="cardNumber" placeholder="1234 5678 2345 9012">
    <label>Expiry Date</label>
    <input type="month" id="expiry">
    <label>CVV</label>
    <input type="password" id="cvv" placeholder="123">
  </div>

  <button onclick="processPayment()">Pay Now</button>
</div>

<script>
const cart = JSON.parse(localStorage.getItem("checkout_items")) || [];
const total = localStorage.getItem("checkout_total") || 0;
const email = localStorage.getItem("checkout_email") || "";

const tbody = document.querySelector("#summaryTable tbody");
const totalEl = document.getElementById("totalAmount");
const emailEl = document.getElementById("emailDiv");

function renderSummary(){
  tbody.innerHTML = "";
  if(cart.length === 0){
    tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;">Your cart is empty.</td></tr>`;
  } else {
    cart.forEach(item=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${item.name}</td><td>${item.qty}</td><td>Ksh ${parseFloat(item.price)*item.qty}</td>`;
      tbody.appendChild(tr);
    });
  }
  totalEl.textContent = "Total: Ksh " + total;
  emailEl.textContent = "Email: " + email;
}
renderSummary();

function toggleMethod(){
  let m = document.getElementById("method").value;
  document.getElementById("mpesaForm").style.display = m==="mpesa"?"block":"none";
  document.getElementById("cardForm").style.display = m==="card"?"block":"none";
}

function processPayment(){
  if(total <= 0){
    alert("Your total is 0. Please add items.");
    return;
  }

  let method = document.getElementById("method").value;

  if(method==="mpesa"){
    let phone = document.getElementById("mpesaPhone").value;
    if(phone.length<10){ alert("Enter valid M-Pesa number!"); return; }
  }

  if(method==="card"){
    let card = document.getElementById("cardNumber").value;
    let cvv = document.getElementById("cvv").value;
    if(card.length<16 || cvv.length<3){ alert("Enter valid card details!"); return; }
  }

  // Save for receipt
  const receipt = {
    orderId: "ORD-"+Math.floor(Math.random()*99999),
    date: new Date().toLocaleString(),
    total: total,
    method: method.toUpperCase(),
    email: email,
    items: cart
  };
  localStorage.setItem("last_receipt", JSON.stringify(receipt));

  // Clear cart
  localStorage.removeItem("one_stop_cart");
  localStorage.removeItem("checkout_items");
  localStorage.removeItem("checkout_total");
  localStorage.removeItem("checkout_email");

  window.location.href = "receipt.html";
}
</script>

</body>
</html>
